<html>
<head>
	<title>LeaderBoard notification Demo :</title>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<style type="text/css">
        *{margin:0;padding:0;font-family:Arial, sans-serif;font-size:11px;color: #666;}
        .title{display: block;width: 358px;text-align: center;font-size: 1.5em;color: #333;font-weight: bold;}
        .leaderboard {overflow:hidden;max-width: 330px;border:1px solid #ccc;display:inline-block;position:relative;list-style-position: outside;padding: 0px 0px 0px 25px;}
        .leaderboard li {width: 320px;font-weight:bold;position:relative;list-style-type: decimal;border-bottom:1px solid #ccc;padding: 5px;-webkit-transition: all 1s ease;transition: all 1s ease;}
        .leaderboard li.leave{left:360px;opacity:0;}
        .leaderboard li.enter{left:360px;opacity:0;display:none;}
        .leaderboard li:last-child {border-bottom:none;}
        .leaderboard li span{color:#ccc;font-size:0.8em;font-weight:normal;float:right;line-height: 1.5em;}
        .leaderboard li span:after{content:" ";clear:both;float:right;}
	</style>
</head>
<body>
	<!-- html leaderboard goes here -->
	<script src="socket.io/socket.io.js"></script>
	<script type="text/javascript">
	   /**
	    * Retrieve param from GET method 
	    */
        function gup ( name )
        {
            name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");  
            var regexS = "[\\?&]"+name+"=([^&#]*)",
                regex = new RegExp( regexS ),
                results = regex.exec( window.location.href );
            if( results == null || results == undefined || results == "" ) return "";  
            else return results[1];
        }
        
		var Users = function (opt)
		{
			var self = this;
			this.opt = opt || {daddy : 'body'};
			this.dataUsers = null;
			this.container = $('<ul class="leaderboard"/>');
			
			$(this.opt.daddy).append('<di class="title">Leader board demo</div>');
            $(this.opt.daddy).append(this.container);
			
			this.init = function (data)
			{
				var lis = [];
				this.dataUsers = data;
				$.each(this.dataUsers, function (i, o)
				{
					lis.push($('<li/>', {
						"class" : "user",
						"html" : o.username + " earned " + o.points + " points! <span>[SERVER REQUEST TIME]</span>"
					}));
				});
				self.container.append(lis);
			}
			
			this.updtUser = function (data)
			{
			    var _this = this, last = this.container.find('li:last-child');
				last.addClass('leave');
				setTimeout(function ()
				{
				    // REMOVE
				    var newLi = $('<li/>', {
                        "class" : "user leave",
                        "html" : data.username +
                                " earned " + data.points +
                                " points! <span>[" + new Date().toLocaleDateString() + ", " + new Date().toLocaleTimeString() + "]</span>"
                    });
				    last.remove();
				    
				    // ADD 
                    _this.container.prepend(newLi);
                    
                    newLi.delay(1000).delay(1).queue(function()
                    {
                        $(this).removeClass('leave')
                    });
                    
				}, 1000);
			}
			
			return this;
		}
		
		$(document).ready(function () { 
		    var LeaderBoardRoomRequested = gup( 'roomID' );
		    if(LeaderBoardRoomRequested == "") return;
		    
			var socket = io.connect('http://localhost:8333/'),
				users = null;
			
            socket.on('connect', function ()
            {
                console.log('connect');
                // ask for the 10 last user in databases from a specifique room
            });
            
			
			socket.on('update', function (data)
			{
				// new data are retrieve -> update the html
				if( data == null || data == undefined ||
					((data.users == null || data.users == undefined) &&
					(data.user == null || data.user == undefined))
				) return;
					
				if(users == null) users = new Users();
				
				if(data.users) users.init(data.users);
				else users.updtUser(data.user);
				
			});
			
            socket.emit('leaderboard', { room : LeaderBoardRoomRequested });
			
		});
	</script>
</body>
</html>